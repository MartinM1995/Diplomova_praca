{"version":3,"file":"app.js","sources":["../server/db.js","../server/app.js"],"sourcesContent":["const mongoose = require(\"mongoose\");\n\nexport const ALLOWED_STATUS = [\"NOT_TESTED\", \"CORRECT\", \"CORRUPT\"];\n\nexport const DataSchema = new mongoose.Schema(\n  {\n    _id: \"String\",\n    name: \"String\",\n    filePath: \"String\",\n    status: \"String\",\n    data: {\n      k4_co: \"String\",\n      k4_co2: \"String\",\n      k4_h2: \"String\",\n      k4_o2: \"String\",\n      k41_p_o2_out: \"String\",\n      k41_prietok_o2: \"String\",\n      k41_vyska_trysky: \"String\",\n      k42_p_o2_out: \"String\",\n      k42_prietok_o2: \"String\",\n      k42_vyska_trysky: \"String\",\n      oc2_comm1_k4_fukanie: \"String\",\n      oc2_k4_dynamicky_model_rychlost_oduhlicenia: \"String\",\n      oc2_k4_p_podtlak_pretlak_dymnik: \"String\",\n      oc2_k4_zkp_analyza_co2_q4341b: \"String\",\n      oc2_k4_zkp_analyza_co_q4341a: \"String\",\n      oc2_k4_zkp_analyza_h2_q4341d: \"String\",\n      oc2_k4_zkp_analyza_o2_q4341c: \"String\",\n      oc2_k4_zkp_prietok_spalin_aktualny: \"String\",\n      oc2_k4_zkp_prietok_spalin_normovany: \"String\",\n      oc2_k4_zkp_tep_odpad_plyn_vent_t4339_1: \"String\",\n      oc2_k4_zkp_tep_odpad_plyn_vent_t4339_2: \"String\",\n      oc2_k4_zkp_tlak_odpad_plyn_vent_p4338: \"String\",\n      oc2_plck4_meranie_prietoku_spal_promecon: \"String\",\n      oc2_plck4_podtlak_granivor_vystup: \"String\",\n      oc2_plck4_vai_hladina_vody_v_kvap_odlucovaci_l4388: \"String\",\n      oc2_plck4_vai_teplota_1_na_vst_do_granivoru: \"String\",\n      oc2_plck4_vai_teplota_1_odpad_plyn_za_gran: \"String\",\n      oc2_plck4_vai_teplota_2_na_vst_do_granivoru: \"String\",\n      oc2_plck4_vai_teplota_2_odpad_plyn_za_gran: \"String\",\n    },\n  },\n  { strict: false }\n);\nexport const Data = mongoose.model(\"Data\", DataSchema);\nexport const DataModel = new Data();\n\nexport function connectDB() {\n  mongoose.connect(\"mongodb://localhost:27017/mroc-dipl\", { useNewUrlParser: true });\n\n  const db = mongoose.connection;\n  db.on(\"error\", console.error.bind(console, \"connection error:\"));\n  db.once(\"open\", function() {\n    console.log(\"Pripojenie do databázy prebehlo úspešne.\");\n  });\n}\n","import express from \"express\";\nimport path from \"path\";\nimport bodyParser from \"body-parser\";\nimport multer from \"multer\";\nimport xlstojson from \"xls-to-json-lc\";\nimport xlsxtojson from \"xlsx-to-json-lc\";\nimport mongoose from \"mongoose\";\nimport { connectDB, Data } from \"./db\";\n\nconst app = express();\n\nconnectDB();\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\n\nvar storage = multer.diskStorage({\n  //multers disk storage settings\n  destination: function(req, file, cb) {\n    cb(null, \"./uploads/\");\n  },\n  filename: function(req, file, cb) {\n    var datetimestamp = Date.now();\n    cb(\n      null,\n      file.fieldname + \"-\" + datetimestamp + \".\" + file.originalname.split(\".\")[file.originalname.split(\".\").length - 1]\n    );\n  },\n});\n\nvar upload = multer({\n  //multer settings\n  storage: storage,\n  fileFilter: function(req, file, callback) {\n    //file filter\n    if ([\"xls\", \"xlsx\"].indexOf(file.originalname.split(\".\")[file.originalname.split(\".\").length - 1]) === -1) {\n      return callback(new Error(\"Wrong extension type\"));\n    }\n    callback(null, true);\n  },\n}).single(\"file\");\n\n/** API path that will upload the files */\napp.post(\"/upload\", function(req, res) {\n  var exceltojson;\n  upload(req, res, function(err) {\n    if (err) {\n      res.json({ error_code: 1, err_desc: err });\n      return;\n    }\n    /** Multer gives us file info in req.file object */\n    if (!req.file) {\n      res.json({ error_code: 1, err_desc: \"No file passed\" });\n      return;\n    }\n    /** Check the extension of the incoming file and\n     *  use the appropriate module\n     */\n    if (req.file.originalname.split(\".\")[req.file.originalname.split(\".\").length - 1] === \"xlsx\") {\n      exceltojson = xlsxtojson;\n    } else {\n      exceltojson = xlstojson;\n    }\n    console.log(req.file.path);\n    try {\n      exceltojson(\n        {\n          input: req.file.path,\n          output: null, //since we don't need output.json\n          lowerCaseHeaders: true,\n        },\n        function(err, result) {\n          if (err) {\n            return res.json({ error_code: 1, err_desc: err, data: null });\n          }\n          const doc = new Data({\n            _id: new mongoose.Types.ObjectId(),\n            name: req.file.filename,\n            filePath: req.file.path,\n            data: result,\n            status: \"NOT_TESTED\"\n          });\n          doc.save(result, function(err, success) {\n            if (err) {\n              console.error(err);\n              return;\n            }\n            console.log(success);\n            console.log(success._id)\n            res.json({ error_code: 0, err_desc: null, data: result });\n          });\n        }\n      );\n    } catch (e) {\n      res.json({ error_code: 1, err_desc: \"Corupted excel file\" });\n    }\n  });\n});\n\napp.get(\"/data\", function(req, res) {\n  Data.find({}, function(err, result) {\n    if (err) {\n      res.json({ error_code: 1, err_desc: \"Empty dataset\" });\n    } else {\n      res.json({ error_code: 0, err_desc: null, data: result });\n    }\n  });\n});\n\napp.get(\"/data/:id\", function(req, res) {\n  Data.findById(req.params.id, function(err, result) {\n    if (err) {\n      res.json({ error_code: 1, err_desc: \"Empty dataset\" });\n    } else {\n      console.log(result);\n      res.json({ error_code: 0, err_desc: null, data: result });\n    }\n  });\n});\n\napp.use('/', express.static(path.join(__dirname, '../public')))\n\napp.get(\"/\", function(req, res) {\n  res.sendFile(path.join(__dirname, \"../public/index.html\"));\n});\n\napp.listen(\"3000\", function() {\n  console.log(\"running on 3000...\");\n});\n"],"names":["mongoose"],"mappings":"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"}